---
layout: default
title: Practical Vim
category: Reading Notes
---

## TBC

**Configuration**

1. 为 vimrc 配置一些基本选项
2. Tim Pope 的 rails.vim 插件
3. Kana Natsuno 自定义文本对象
4. 代码补全、编译及错误跳转

**Questions**

- `CTRL+O` vs `CTRL+T`
- `CTRL+]` vs `CTRL+I`

## Terms

macro - In computing, a macro is a shortened version of a computer command which makes the computer carry out a set of actions.

## Here We Go

### 准备工作

#### 使用 Vim 的出厂配置

在 shell 中执行

    vim -u NONE -N

`-u NONE` 标志让 Vim 在启动时不加载你的 vimrc，这样，你的定制项就不会生效，插件也会被禁用。当用不加载 vimrc 文件的方式启动时，Vim 会切换到 vi 兼容模式，这将导致很多有用的功能被禁用，而 `-N` 标志则会启用‘nocompatible’选项，防止进入 vi 兼容模式。

本书中所说的 Vim 的出厂配置，指的是激活了内置的插件功能，并且禁用了 vi 兼容模式时的配置。

    set nocompatible
    filetype plugin on

在启动 Vim 时，可以用其他文件取代你的 vimrc，如：

    vim -u fakepath/essential.vim

#### Vim 脚本所扮演的角色

Vim 脚本让我们可以给 Vim 添加新的功能，或是改变其已有的功能。

#### 查看 Vim 版本

有些 Vim 功能可以在编译期间被禁用。例如，在配置编译选项时，我们可以传入 '--with-features=tiny' 参数，这会禁用除最基本的功能外的其他所有功能（Vim 的功能集还包括 small、normal、big 和 huge）。可以查阅 `:h +feature-list`，浏览完整的功能列表。

如果发现自己的 Vim 缺少本书所讨论的某个功能，那么你也许正在使用一个最小功能集的 Vim 发行版。你可以用 `:version` 命令检查此功能是否可用。

### 第 1 章 Vim 解决问题的方式

学会规划按键动作，使得在重复时能完成一项有用的工作。

#### 技巧 1 认识 . 命令

> `.` 重复上次修改

什么是修改？

普通模式中，一次修改的单位可以是:

- 字符，如 `x`
- 整行，如 `dd`
- 整个文件，如 `>G`

每次进入插入模式时，也会形成一次修改：从进入插入模式的那一刻起 (例如，输入 `i`)，直到返回普通模式时为止 (输入 `<Esc>`)。

Note: 在插入模式中移动光标会重置修改状态。

#### 技巧 2 不要自我重复

复合命令|等效长命令	|功能
--------|---------------|------------------------------------------
`C`     |`c$`		|删除光标位置到行尾的内容，并进入插入模式
`s`     |`cl`		|删除光标位置的字符，并进入插入模式
`S`     |`^C`		|删除当前行，并进入插入模式
`I`     |`^i`		|光标移动到行首，并进入插入模式
`A`     |`$a`		|光标移动到行尾，并进入插入模式
`o`     |`A<CR>`	|在当前行下一行插入一个空行，并进入插入模式
`O`     |`ko`		|在当前行上一行插入一个空行，并进入插入模式

#### 技巧 3 以退为进

使修改可重复

> `s`		删除光标下的字符，然后进入插入模式。

使移动可重复

> `f{char}`	查找右侧下一处指定字符出现的位置，把光标放在 {char} 上。
> `F{char}` 	查找左侧下一处指定字符出现的位置，把光标放在 {char} 上。
> `t{char}` 	直到右侧下一处出现指定字符之前，把光标放在 {char} 左边的位置。
> `T{char}` 	直到左侧下一处出现指定字符之后，把光标放在 {char} 右边的位置。
> `;`		重复上次的 f、t、F 或者 T 命令。
> `,`		反方向重复上次的 f、t、F 或者 T 命令。

然后合而为一

> `;.`

#### 技巧 4 执行、重复、回退

> 在面对重复性工作时，我们需要让移动动作和修改都能够重复，这样就可以达到最佳编辑模式。

**可重复的操作及如何回退**

目的			|操作			|重复	|回退
------------------------|-----------------------|-------|-------
做出一个修改		|{edit}			|`.`	|`u`
在行内查找下一指定字符	|`f{char}`/`t{char}`	|`;`	|`,`
在行内查找上一指定字符	|`F{char}`/`T{char}`	|`;`	|`,`
在文档中查找下一处匹配项|/pattern`<CR>`		|`n`	|`N`
在文档中查找上一处匹配项|?pattern`<CR>`		|`n`	|`N`
执行替换		|:s/target/replacement	|`&`	|`u`
执行一系列修改		|`qx{changes}q`		|`@x`	|`u`

#### 技巧 5 查找并手动替换

> `:substitute` 命令专门用于查找替换任务，如 `:%s/target/replacement/gc`

无需输入就可以进行查找

> `*` 查找当前光标下的单词，光标跳到下一个匹配项上，按 `n` 可以跳到下一个匹配项。

使修改可重复

> `cw` 删除从光标位置到单词结尾的字符，并进入插入模式。

合而为一

> `n.`

#### 技巧 6 认识 `.` 范式

**理想模式：用一键移动，另一键执行**

## 第一部分 模式

### 第 2 章 普通模式 (Normal Mode)

许多普通模式命令可以在执行时指定执行的次数，但并不是说一定要这样做，有时简单地重复执行一条命令，比花时间去想执行多少次要更好。

#### 技巧 8 把撤销单元切成块

在 Vim 中，我们自己可以控制撤销命令的粒度。

`u` 键会触发撤销命令，会撤销最新的修改。一次修改可以是改变文档内文本的任意操作，包括

- 在普通模式、可视模式以及命令行模式中所触发的命令
- 在插入模式中输入 (或删除) 的文本，即 `i{insert some text}<Esc>` 是一次修改

只要控制好对 `<Esc>` 键的使用，就可使撤销命令作用于单词、句子或段落。

应该多久离开一次插入模式？让每个“可撤销块”对应一次思考过程，当思考停顿的时间长到足以问“我应该退出插入模式吗？”这个问题时应该退出了。

当处于插入模式时，如果光标位于行尾，用 `<Esc>o` 代替 `<CR>` 另起一行。

Note: 如果在插入模式中使用了 <Up> 、<Down> 、<Left> 或 <Right> 这些光标键，将会产生一个新的撤销块。你可以把这想象为先切换回普通模式，然后用 h 、j 、k 或 l 命令对光标进行了移动，唯一区别是我们并没有退出插入模式。这也会对 . 命令的操作产生影响。

---

① http://vimgolf.com/


如果你经常使用八进制，Vim 的缺省行为或许会适合你。如果不是这样，那么你
可能想把下面这行加入你的 vimrc 里：
set nrformats=
这会让 Vim 把所有数字都当成十进制，不管它们是不是以 0 开头的。


操作符与动作命令的结合形成了一种语法。这种语法的第一条规则很简单，即一
个操作由一个操作符，后面跟一个动作命令组成。

Vim 的语法只有一条额外规则，即当一个操作符命令被连续调用两次时，它会作
用于当前行。

表 2-1 Vim 的操作符命令
命令 用途
c 修改
d 删除
y 复制到寄存器
g~ 反转大小写
gu 转换为小写
gU 转换为大写
> 增加缩进
< 减小缩进
= 自动缩进
! 使用外部程序过滤{motion}所跨越的行


自定义操作符与已有动作命令协同工作
随同 Vim 发布的标准操作符集合相对比较少，但我们可以定义新的操作符。Tim
Pope 的 commentary.vim 插件提供了一个很好的例子①，此插件为 Vim 所支持的编程语
言增添了注释及取消注释的命令。
注释命令以 \\{motion} 触发，它会切换指定行的注释状态。它是一个操作符命
令，因此可以把它和所有动作命令结合在一起。\\ap 将切换当前段落的注释状态，
\\G 会把从当前行到文件结尾间的所有内容注释掉，而 \\\ 则注释当前行。
如果你对如何创建自定义操作符感到好奇，可以先阅读一下文档 : h :map-operator 。
① https://github.com/tpope/vim-commentary
